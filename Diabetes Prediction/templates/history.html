<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Dataset Distribution - Diabetes Risk Predictor</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
  <div class="container">
    <h1>Dataset Distribution</h1>
    <canvas id="historyChart" width="400" height="300"></canvas>
    <a href="{{ url_for('index') }}" class="btn back-btn">Back to Predictor</a>
  </div>

  <script>
    async function loadHistory() {
      const response = await fetch('/api/history');
      const data = await response.json();

      // Count occurrences of each diagnosis
      const counts = { 'Diabetic': 0, 'Not Diabetic': 0 };
      data.forEach(record => {
        if(record.Diagnosis === 'Diabetic') counts['Diabetic']++;
        else counts['Not Diabetic']++;
      });

      const ctx = document.getElementById('historyChart').getContext('2d');

      new Chart(ctx, {
        type: 'pie',
        data: {
          labels: ['Diabetic', 'Not Diabetic'],
          datasets: [{
            data: [counts['Diabetic'], counts['Not Diabetic']],
            backgroundColor: ['#e74c3c', '#3498db'],
            borderColor: '#fff',
            borderWidth: 2,
            hoverOffset: 20
          }]
        },
        options: {
          responsive: true,
          plugins: {
            legend: {
              position: 'bottom',
              labels: { font: { size: 16 } }
            },
            title: {
              display: true,
              text: 'Patient Diagnosis Distribution',
              font: { size: 20, weight: 'bold' }
            }
          }
        }
      });
    }

    loadHistory();
  </script>
</body>
</html>
